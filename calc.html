<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Планировщик занятий</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff7e5f;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .settings-panel {
            padding: 20px;
            background-color: var(--light-color);
            border-bottom: 1px solid #ddd;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }
        
        .activities-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .activity-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .activity-item input {
            flex: 1;
        }
        
        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #e86a4a;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #5a7ca8;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .typical-week {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .week-day {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: #f9f9f9;
        }
        
        .week-day.weekend {
            background-color: #fff0f0;
        }
        
        .day-name {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .day-activities {
            min-height: 120px;
        }
        
        .activity-slot {
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            color: white;
            position: relative;
        }
        
        .activity-slot.empty {
            background-color: #eee;
            color: #999;
            border: 1px dashed #ccc;
        }
        
        .remove-activity {
            position: absolute;
            top: 2px;
            right: 5px;
            background: rgba(0,0,0,0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }
        
        .activity-slot:hover .remove-activity {
            display: block;
        }
        
        .calendar-container {
            padding: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background-color: #ddd;
            border: 1px solid #ddd;
        }
        
        .calendar-day {
            background-color: white;
            min-height: 100px;
            padding: 5px;
            position: relative;
        }
        
        .calendar-day.weekend {
            background-color: #f9f9f9;
        }
        
        .calendar-day.other-month {
            background-color: #f9f9f9;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .day-number.other-month {
            color: #bbb;
        }
        
        .activity-marker {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 2px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .activity-marker.other-month {
            opacity: 0.5;
        }
        
        .day-actions {
            margin-top: 5px;
            display: flex;
            gap: 5px;
        }
        
        .day-actions button {
            padding: 2px 5px;
            font-size: 12px;
            background: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .week-row {
            display: contents;
        }
        
        .week-summary {
            background-color: #f0f7ff;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-left: 2px solid var(--primary-color);
        }
        
        .week-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .week-cost {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .results-panel {
            padding: 20px;
            background-color: var(--light-color);
            border-top: 1px solid #ddd;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .result-card {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 10px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            width: 300px;
            max-width: 90%;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .week-days {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar {
                grid-template-columns: repeat(8, 1fr);
                font-size: 12px;
            }
            
            .calendar-day {
                min-height: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Планировщик занятий</h1>
            <p>Учет занятий и расчет оплаты за учебный год</p>
        </header>
        
        <div class="settings-panel">
            <div class="form-group">
                <label for="student-name">Имя ученика:</label>
                <input type="text" id="student-name" placeholder="Введите имя ученика">
            </div>
            
            <div class="form-group">
                <label>Период занятий:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="date" id="start-date" value="2025-09-01">
                    <input type="date" id="end-date" value="2026-06-30">
                </div>
            </div>
            
            <div class="activities-panel">
                <h3>Типы занятий и их стоимость</h3>
                <div id="activities-list">
                    <div class="activity-item">
                        <input type="text" class="activity-name" placeholder="Название занятия" value="Математика">
                        <input type="number" class="activity-price" placeholder="Стоимость" value="500" min="0">
                        <span class="activity-color" style="display: inline-block; width: 20px; height: 20px; background-color: #ff7e5f; border-radius: 50%;"></span>
                        <button class="btn btn-secondary remove-activity-btn">×</button>
                    </div>
                    <div class="activity-item">
                        <input type="text" class="activity-name" placeholder="Название занятия" value="Английский">
                        <input type="number" class="activity-price" placeholder="Стоимость" value="600" min="0">
                        <span class="activity-color" style="display: inline-block; width: 20px; height: 20px; background-color: #4a6fa5; border-radius: 50%;"></span>
                        <button class="btn btn-secondary remove-activity-btn">×</button>
                    </div>
                </div>
                <button id="add-activity" class="btn">Добавить занятие</button>
            </div>
            
            <div class="typical-week">
                <h3>Типовая неделя</h3>
                <div class="week-days">
                    <div class="week-day">
                        <div class="day-name">Понедельник</div>
                        <div class="day-activities" data-day="1">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day">
                        <div class="day-name">Вторник</div>
                        <div class="day-activities" data-day="2">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day">
                        <div class="day-name">Среда</div>
                        <div class="day-activities" data-day="3">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day">
                        <div class="day-name">Четверг</div>
                        <div class="day-activities" data-day="4">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day">
                        <div class="day-name">Пятница</div>
                        <div class="day-activities" data-day="5">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day weekend">
                        <div class="day-name">Суббота</div>
                        <div class="day-activities" data-day="6">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                    <div class="week-day weekend">
                        <div class="day-name">Воскресенье</div>
                        <div class="day-activities" data-day="0">
                            <div class="activity-slot empty" data-slot="0">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="1">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="2">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="3">+ Добавить</div>
                            <div class="activity-slot empty" data-slot="4">+ Добавить</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button id="apply-schedule" class="btn">Применить расписание к календарю</button>
                </div>
            </div>
        </div>
        
        <div class="calendar-container">
            <div class="calendar-header">
                <h2 id="current-month">Сентябрь 2025</h2>
                <div class="month-nav">
                    <button id="prev-month" class="btn">←</button>
                    <button id="next-month" class="btn">→</button>
                </div>
            </div>
            <div class="calendar" id="calendar">
                <!-- Calendar will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="results-panel">
            <h2>Результаты</h2>
            <div class="results-grid">
                <div class="result-card">
                    <h3>Занятий в неделю</h3>
                    <div class="result-value" id="weekly-lessons">0</div>
                </div>
                <div class="result-card">
                    <h3>Стоимость в неделю</h3>
                    <div class="result-value" id="weekly-cost">0 руб.</div>
                </div>
                <div class="result-card">
                    <h3>Занятий за год</h3>
                    <div class="result-value" id="yearly-lessons">0</div>
                </div>
                <div class="result-card">
                    <h3>Стоимость за год</h3>
                    <div class="result-value" id="yearly-cost">0 руб.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Текущая дата для календаря
            let currentDate = new Date(2025, 8, 1); // Сентябрь 2025
            
            // Данные о занятиях
            let activities = [
                { name: 'Математика', price: 500, color: '#ff7e5f' },
                { name: 'Английский', price: 600, color: '#4a6fa5' }
            ];
            
            // Типовая неделя
            let typicalWeek = {
                1: [], // Понедельник
                2: [], // Вторник
                3: [], // Среда
                4: [], // Четверг
                5: [], // Пятница
                6: [], // Суббота
                0: []  // Воскресенье
            };
            
            // Расписание по дням
            let schedule = {};
            
            // Инициализация
            initCalendar();
            updateResults();
            initTypicalWeek();
            
            // Обработчики событий
            document.getElementById('add-activity').addEventListener('click', addActivity);
            document.getElementById('prev-month').addEventListener('click', showPrevMonth);
            document.getElementById('next-month').addEventListener('click', showNextMonth);
            document.getElementById('apply-schedule').addEventListener('click', applyScheduleToCalendar);
            
            // Обновление результатов при изменении настроек
            document.querySelectorAll('#student-name, #start-date, #end-date').forEach(element => {
                element.addEventListener('change', updateResults);
            });
            
            // Функции
            
            function initCalendar() {
                generateCalendar(currentDate);
            }
            
            function generateCalendar(date) {
                const calendar = document.getElementById('calendar');
                calendar.innerHTML = '';
                
                // Заголовки дней недели (начинаем с понедельника)
                const daysOfWeek = ['ПН', 'ВТ', 'СР', 'ЧТ', 'ПТ', 'СБ', 'ВС', 'Сумма'];
                daysOfWeek.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.textContent = day;
                    dayHeader.style.fontWeight = 'bold';
                    dayHeader.style.textAlign = 'center';
                    dayHeader.style.padding = '10px';
                    dayHeader.style.backgroundColor = '#f0f0f0';
                    calendar.appendChild(dayHeader);
                });
                
                // Первый день месяца
                const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
                // Последний день месяца
                const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                
                // Находим первый понедельник месяца
                let startDate = new Date(firstDay);
                while (startDate.getDay() !== 1) {
                    startDate.setDate(startDate.getDate() - 1);
                }
                
                // Находим последнее воскресенье месяца
                let endDate = new Date(lastDay);
                while (endDate.getDay() !== 0) {
                    endDate.setDate(endDate.getDate() + 1);
                }
                
                // Группируем дни по неделям
                let weeks = [];
                let currentWeek = [];
                let currentDate = new Date(startDate);
                
                // Заполняем календарь днями
                while (currentDate <= endDate) {
                    if (currentWeek.length === 7) {
                        weeks.push(currentWeek);
                        currentWeek = [];
                    }
                    
                    currentWeek.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (currentWeek.length > 0) {
                    weeks.push(currentWeek);
                }
                
                // Отображаем недели
                weeks.forEach((week, weekIndex) => {
                    // Дни недели
                    week.forEach(day => {
                        const dayCell = document.createElement('div');
                        dayCell.classList.add('calendar-day');
                        
                        // Проверка на выходной (суббота и воскресенье)
                        if (day.getDay() === 0 || day.getDay() === 6) {
                            dayCell.classList.add('weekend');
                        }
                        
                        // Проверка на принадлежность к текущему месяцу
                        const isOtherMonth = day.getMonth() !== date.getMonth();
                        if (isOtherMonth) {
                            dayCell.classList.add('other-month');
                        }
                        
                        const dayNumber = document.createElement('div');
                        dayNumber.classList.add('day-number');
                        dayNumber.textContent = day.getDate();
                        
                        // Если день не принадлежит текущему месяцу, делаем его бледным
                        if (isOtherMonth) {
                            dayNumber.classList.add('other-month');
                        }
                        
                        dayCell.appendChild(dayNumber);
                        
                        // Добавление маркеров занятий
                        const dateKey = formatDate(day);
                        if (schedule[dateKey]) {
                            schedule[dateKey].forEach(activityIndex => {
                                const marker = document.createElement('span');
                                marker.classList.add('activity-marker');
                                marker.style.backgroundColor = activities[activityIndex].color;
                                marker.title = activities[activityIndex].name;
                                
                                // Если день не принадлежит текущему месяцу, делаем маркер полупрозрачным
                                if (isOtherMonth) {
                                    marker.classList.add('other-month');
                                }
                                
                                marker.addEventListener('click', function() {
                                    removeActivityFromDay(dateKey, activityIndex);
                                });
                                dayCell.appendChild(marker);
                            });
                        }
                        
                        // Добавление кнопок действий (только для дней текущего месяца)
                        if (!isOtherMonth) {
                            const dayActions = document.createElement('div');
                            dayActions.classList.add('day-actions');
                            
                            const addBtn = document.createElement('button');
                            addBtn.textContent = '+';
                            addBtn.title = 'Добавить занятие';
                            addBtn.addEventListener('click', function() {
                                addActivityToDay(dateKey);
                            });
                            dayActions.appendChild(addBtn);
                            
                            const clearBtn = document.createElement('button');
                            clearBtn.textContent = '×';
                            clearBtn.title = 'Очистить день';
                            clearBtn.addEventListener('click', function() {
                                clearDay(dateKey);
                            });
                            dayActions.appendChild(clearBtn);
                            
                            dayCell.appendChild(dayActions);
                        }
                        
                        calendar.appendChild(dayCell);
                    });
                    
                    // Добавляем сумму за неделю
                    const weekSummary = document.createElement('div');
                    weekSummary.classList.add('week-summary');
                    
                    const weekLabel = document.createElement('span');
                    weekLabel.classList.add('week-label');
                    weekLabel.textContent = `Неделя ${weekIndex + 1}`;
                    weekSummary.appendChild(weekLabel);
                    
                    const weekCost = document.createElement('span');
                    weekCost.classList.add('week-cost');
                    const weekTotal = calculateWeekCost(week);
                    weekCost.textContent = `${weekTotal} руб.`;
                    weekSummary.appendChild(weekCost);
                    
                    calendar.appendChild(weekSummary);
                });
                
                // Обновление заголовка месяца
                const monthNames = [
                    'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                    'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'
                ];
                document.getElementById('current-month').textContent = 
                    `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            }
            
            function calculateWeekCost(week) {
                let total = 0;
                
                week.forEach(day => {
                    if (day) {
                        const dateKey = formatDate(day);
                        if (schedule[dateKey]) {
                            schedule[dateKey].forEach(activityIndex => {
                                if (activities[activityIndex]) {
                                    total += activities[activityIndex].price;
                                }
                            });
                        }
                    }
                });
                
                return total;
            }
            
            function showPrevMonth() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                generateCalendar(currentDate);
                updateResults();
            }
            
            function showNextMonth() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                generateCalendar(currentDate);
                updateResults();
            }
            
            function initTypicalWeek() {
                // Обработчики для слотов занятий в типовой неделе
                document.querySelectorAll('.activity-slot.empty').forEach(slot => {
                    slot.addEventListener('click', function() {
                        const day = this.parentElement.dataset.day;
                        const slotIndex = this.dataset.slot;
                        showActivityModal(day, slotIndex);
                    });
                });
                
                // Обработчики для кнопок удаления занятий
                document.querySelectorAll('.remove-activity-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const activityItem = this.parentElement;
                        activityItem.remove();
                        updateActivitiesFromForm();
                        updateResults();
                    });
                });
                
                // Обработчики для полей ввода занятий
                document.querySelectorAll('.activity-name, .activity-price').forEach(input => {
                    input.addEventListener('change', function() {
                        updateActivitiesFromForm();
                        updateResults();
                    });
                });
            }
            
            function showActivityModal(day, slotIndex) {
                // Создание модального окна для выбора занятия
                const modal = document.createElement('div');
                modal.classList.add('modal');
                
                const modalContent = document.createElement('div');
                modalContent.classList.add('modal-content');
                
                modalContent.innerHTML = `
                    <h3>Выберите занятие</h3>
                    <div id="activity-options"></div>
                    <div class="modal-actions">
                        <button id="cancel-activity" class="btn btn-secondary">Отмена</button>
                    </div>
                `;
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Заполнение вариантов занятий
                const optionsContainer = document.getElementById('activity-options');
                activities.forEach((activity, index) => {
                    const option = document.createElement('div');
                    option.style.display = 'flex';
                    option.style.alignItems = 'center';
                    option.style.marginBottom = '10px';
                    option.style.padding = '5px';
                    option.style.cursor = 'pointer';
                    option.style.borderRadius = '4px';
                    
                    option.innerHTML = `
                        <span class="activity-marker" style="background-color: ${activity.color}; margin-right: 10px;"></span>
                        <span>${activity.name} - ${activity.price} руб.</span>
                    `;
                    
                    option.addEventListener('click', function() {
                        // Добавляем занятие в типовую неделю
                        addActivityToTypicalWeek(day, slotIndex, index);
                        document.body.removeChild(modal);
                    });
                    
                    optionsContainer.appendChild(option);
                });
                
                // Обработчик отмены
                document.getElementById('cancel-activity').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
            }
            
            function addActivityToTypicalWeek(day, slotIndex, activityIndex) {
                const dayElement = document.querySelector(`.day-activities[data-day="${day}"]`);
                const slotElement = dayElement.querySelector(`.activity-slot[data-slot="${slotIndex}"]`);
                
                // Обновляем слот
                slotElement.classList.remove('empty');
                slotElement.textContent = activities[activityIndex].name;
                slotElement.style.backgroundColor = activities[activityIndex].color;
                
                // Добавляем кнопку удаления
                const removeBtn = document.createElement('button');
                removeBtn.classList.add('remove-activity');
                removeBtn.textContent = '×';
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    resetActivitySlot(day, slotIndex);
                });
                slotElement.appendChild(removeBtn);
                
                // Обновляем данные типовой недели
                typicalWeek[day][slotIndex] = activityIndex;
                
                // Обновляем результаты
                updateResults();
            }
            
            function resetActivitySlot(day, slotIndex) {
                const dayElement = document.querySelector(`.day-activities[data-day="${day}"]`);
                const slotElement = dayElement.querySelector(`.activity-slot[data-slot="${slotIndex}"]`);
                
                // Сбрасываем слот
                slotElement.classList.add('empty');
                slotElement.textContent = '+ Добавить';
                slotElement.style.backgroundColor = '';
                slotElement.innerHTML = '+ Добавить';
                
                // Обновляем данные типовой недели
                delete typicalWeek[day][slotIndex];
                
                // Обновляем результаты
                updateResults();
            }
            
            function applyScheduleToCalendar() {
                // Очищаем текущее расписание
                schedule = {};
                
                // Получаем даты начала и конца периода
                const startDate = new Date(document.getElementById('start-date').value);
                const endDate = new Date(document.getElementById('end-date').value);
                
                // Применяем типовую неделю ко всем неделям в периоде
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    const dayOfWeek = currentDate.getDay();
                    const dateKey = formatDate(currentDate);
                    
                    // Добавляем занятия для этого дня из типовой недели
                    if (typicalWeek[dayOfWeek] && typicalWeek[dayOfWeek].length > 0) {
                        // Фильтруем undefined значения
                        schedule[dateKey] = typicalWeek[dayOfWeek].filter(val => val !== undefined);
                    }
                    
                    // Переходим к следующему дню
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                // Обновляем календарь и результаты
                generateCalendar(currentDate);
                updateResults();
                
                alert('Расписание применено к календарю!');
            }
            
            function addActivity() {
                const activitiesList = document.getElementById('activities-list');
                const newActivity = document.createElement('div');
                newActivity.classList.add('activity-item');
                
                const colors = ['#ff7e5f', '#4a6fa5', '#6b8cbc', '#8ac6d1', '#bbeaa6', '#f4e76e'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                newActivity.innerHTML = `
                    <input type="text" class="activity-name" placeholder="Название занятия">
                    <input type="number" class="activity-price" placeholder="Стоимость" min="0">
                    <span class="activity-color" style="display: inline-block; width: 20px; height: 20px; background-color: ${randomColor}; border-radius: 50%;"></span>
                    <button class="btn btn-secondary remove-activity-btn">×</button>
                `;
                
                activitiesList.appendChild(newActivity);
                
                // Добавление обработчика изменения
                newActivity.querySelectorAll('input').forEach(input => {
                    input.addEventListener('change', function() {
                        updateActivitiesFromForm();
                        updateResults();
                    });
                });
                
                // Обработчик для кнопки удаления
                newActivity.querySelector('.remove-activity-btn').addEventListener('click', function() {
                    newActivity.remove();
                    updateActivitiesFromForm();
                    updateResults();
                });
                
                // Обновляем массив activities
                updateActivitiesFromForm();
                updateResults();
            }
            
            function addActivityToDay(dateKey) {
                // Создание модального окна для выбора занятия
                const modal = document.createElement('div');
                modal.classList.add('modal');
                
                const modalContent = document.createElement('div');
                modalContent.classList.add('modal-content');
                
                modalContent.innerHTML = `
                    <h3>Выберите занятие</h3>
                    <div id="activity-options"></div>
                    <div class="modal-actions">
                        <button id="cancel-activity" class="btn btn-secondary">Отмена</button>
                    </div>
                `;
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Заполнение вариантов занятий
                const optionsContainer = document.getElementById('activity-options');
                activities.forEach((activity, index) => {
                    const option = document.createElement('div');
                    option.style.display = 'flex';
                    option.style.alignItems = 'center';
                    option.style.marginBottom = '10px';
                    option.style.padding = '5px';
                    option.style.cursor = 'pointer';
                    option.style.borderRadius = '4px';
                    
                    option.innerHTML = `
                        <span class="activity-marker" style="background-color: ${activity.color}; margin-right: 10px;"></span>
                        <span>${activity.name} - ${activity.price} руб.</span>
                    `;
                    
                    option.addEventListener('click', function() {
                        if (!schedule[dateKey]) {
                            schedule[dateKey] = [];
                        }
                        
                        // Проверка на максимальное количество занятий в день (5)
                        if (schedule[dateKey].length < 5) {
                            schedule[dateKey].push(index);
                            updateResults();
                            generateCalendar(currentDate);
                            document.body.removeChild(modal);
                        } else {
                            alert('Максимальное количество занятий в день - 5');
                        }
                    });
                    
                    optionsContainer.appendChild(option);
                });
                
                // Обработчик отмены
                document.getElementById('cancel-activity').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
            }
            
            function removeActivityFromDay(dateKey, activityIndex) {
                if (schedule[dateKey]) {
                    const index = schedule[dateKey].indexOf(activityIndex);
                    if (index !== -1) {
                        schedule[dateKey].splice(index, 1);
                        
                        // Если занятий в этот день больше нет, удаляем день из расписания
                        if (schedule[dateKey].length === 0) {
                            delete schedule[dateKey];
                        }
                        
                        updateResults();
                        generateCalendar(currentDate);
                    }
                }
            }
            
            function clearDay(dateKey) {
                if (schedule[dateKey]) {
                    delete schedule[dateKey];
                    updateResults();
                    generateCalendar(currentDate);
                }
            }
            
            function updateResults() {
                // Обновление данных о занятиях из формы
                updateActivitiesFromForm();
                
                // Расчет результатов
                const weeklyLessons = calculateWeeklyLessons();
                const weeklyCost = calculateWeeklyCost();
                const yearlyLessons = calculateYearlyLessons();
                const yearlyCost = calculateYearlyCost();
                
                // Обновление интерфейса
                document.getElementById('weekly-lessons').textContent = weeklyLessons;
                document.getElementById('weekly-cost').textContent = weeklyCost + ' руб.';
                document.getElementById('yearly-lessons').textContent = yearlyLessons;
                document.getElementById('yearly-cost').textContent = yearlyCost + ' руб.';
            }
            
            function updateActivitiesFromForm() {
                const activityItems = document.querySelectorAll('.activity-item');
                activities = [];
                
                activityItems.forEach(item => {
                    const nameInput = item.querySelector('.activity-name');
                    const priceInput = item.querySelector('.activity-price');
                    const colorSpan = item.querySelector('.activity-color');
                    
                    activities.push({
                        name: nameInput.value,
                        price: parseInt(priceInput.value) || 0,
                        color: colorSpan.style.backgroundColor || '#cccccc'
                    });
                });
            }
            
            function calculateWeeklyLessons() {
                let total = 0;
                
                // Считаем количество занятий в типовой неделе
                for (const day in typicalWeek) {
                    total += typicalWeek[day].filter(val => val !== undefined).length;
                }
                
                return total;
            }
            
            function calculateWeeklyCost() {
                let total = 0;
                
                // Считаем стоимость занятий в типовой неделе
                for (const day in typicalWeek) {
                    typicalWeek[day].forEach(activityIndex => {
                        if (activityIndex !== undefined && activities[activityIndex]) {
                            total += activities[activityIndex].price;
                        }
                    });
                }
                
                return total;
            }
            
            function calculateYearlyLessons() {
                let total = 0;
                
                // Получаем даты начала и конца периода
                const startDate = new Date(document.getElementById('start-date').value);
                const endDate = new Date(document.getElementById('end-date').value);
                
                // Считаем реальное количество занятий в выбранном периоде
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    const dateKey = formatDate(currentDate);
                    if (schedule[dateKey]) {
                        total += schedule[dateKey].length;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                return total;
            }
            
            function calculateYearlyCost() {
                let total = 0;
                
                // Получаем даты начала и конца периода
                const startDate = new Date(document.getElementById('start-date').value);
                const endDate = new Date(document.getElementById('end-date').value);
                
                // Считаем реальную стоимость занятий в выбранном периоде
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    const dateKey = formatDate(currentDate);
                    if (schedule[dateKey]) {
                        schedule[dateKey].forEach(activityIndex => {
                            if (activities[activityIndex]) {
                                total += activities[activityIndex].price;
                            }
                        });
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                return total;
            }
            
            function formatDate(date) {
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
            }
        });
    </script>
</body>
</html>